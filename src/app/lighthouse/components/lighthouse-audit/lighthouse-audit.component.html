<div *ngIf="loading" class="loading-indicator">Loading...</div>

<!-- Performance Metrics Section -->
<div *ngIf="metrics.performance && !loading">
  <h2>Performance Metrics</h2>
  <p>First Contentful Paint: {{ metrics.performance.firstContentfulPaint }}</p>
  <p>Speed Index: {{ metrics.performance.speedIndex }}</p>
  <p>Largest Contentful Paint: {{ metrics.performance.largestContentfulPaint }}</p>
  <p>Time to Interactive: {{ metrics.performance.interactive }}</p>
  <p>Total Blocking Time: {{ metrics.performance.totalBlockingTime }}</p>
  <p>Cumulative Layout Shift: {{ metrics.performance.cumulativeLayoutShift }}</p>
</div>

<!-- Sustainability Metrics Section -->
<div *ngIf="metrics.sustainability && !loading">
  <h2>Sustainability Metrics</h2>
  <div *ngIf="metrics.sustainability.resourceBreakdown?.length > 0">
    <p>
      Total CO₂ Emissions:
      <strong>{{ metrics.sustainability.totalCO2 }} g</strong>
      (<strong>{{ (metrics.sustainability.totalCO2 * 1000) | number:'1.0-2' }} mg</strong>)
    </p>

    <h3>Resource Breakdown</h3>
    <table>
      <thead>
        <tr>
          <th>Resource Type</th>
          <th>Total Size (MB)</th>
          <th>CO₂ Emissions (mg)</th>
          <th>Contribution (%)</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let resource of metrics.sustainability.resourceBreakdown">
          <td>{{ resource.resourceType }}</td>
          <td>{{ resource.size }}</td>
          <td>{{ (resource.co2 * 1000) | number:'1.0-2' }} mg</td>
          <td>{{ resource.contribution }}</td>
        </tr>
      </tbody>
    </table>
    <p><i>Note:</i> Contribution refers to the percentage of total CO₂ emissions generated by each resource type.</p>
  </div>
</div>

<!-- URL Input and Audit Trigger Section -->
<div class="audit-section">
  <input
    type="text"
    [(ngModel)]="auditUrl"
    placeholder="Enter URL to audit"
  />
  <button (click)="runAudit(auditUrl)" [disabled]="loading">
    Run Audit
  </button>
</div>

<!-- Suggested Goal Section -->
<div *ngIf="!loading && metrics.sustainability?.totalCO2" class="suggested-goal">
  <p>
    Your current total CO₂ emissions are:
    <strong>{{ metrics.sustainability.totalCO2 }} g</strong>
    (<strong>{{ (metrics.sustainability.totalCO2 * 1000) | number:'1.0-2' }} mg</strong>).
    We suggest reducing it by 10% for the next iteration, which is
    <strong>{{ goalMg }} mg</strong>.
  </p>
  <button (click)="applySuggestedGoal()">Apply Suggested Goal</button>
</div>

<!-- Goal Setting Section -->
<div class="goal-section">
  <h2>Set Your Sustainability Goal for Next Iteration</h2>
  <label for="sustainabilityGoal">CO₂ Emissions Goal (g):</label>
  <input
    id="sustainabilityGoal"
    type="number"
    [(ngModel)]="goal"
  />
  <button (click)="saveGoal()">Save Goal</button>
  <p *ngIf="goalMessage">{{ goalMessage }}</p>
  <div *ngIf="savedGoal">
    <p>Currently saved goal for {{ auditUrl }}: {{ savedGoal.sustainabilityGoal }} g</p>
  </div>

  <div class="goal-guide">
    <h3>How Does This Goal Work?</h3>
    <ul>
      <li><strong>What is this goal?</strong> A benchmark defining the CO₂ target for your next iteration.</li>
      <li><strong>Why is it useful?</strong> It tracks improvements and can trigger actions in CI/CD if targets aren’t met.</li>
      <li><strong>How to use it?</strong> Rerun the audit after optimizations to see the gap close toward zero.</li>
      <li><strong>Relevance:</strong> Reducing emissions boosts performance and shows commitment to sustainability.</li>
    </ul>
  </div>
</div>
